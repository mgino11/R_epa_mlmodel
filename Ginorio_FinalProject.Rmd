---
title: ""
author: "MGinorio"
date: "`r format(Sys.Date(), '%B %d %Y')`"
output:
  html_document:
    highlight: pygments
    theme: sandstone
    toc: false
    toc_float: false
  prettydoc::html_pretty:
    theme: cayman
  pdf_document: default
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Quality of Drinking Water 
## Overview{.tabset .tabset-pills}
### Overview

**ENVIROFACTS EPA Public API to obtain data**
Envirofacts has developed a RESTful data service API to all of its internal data holdings. This functionality provides a user of Envirofacts with the ability to query any table through the use of a URL. The default output is in XML, which can be utilized in other applications, as well as tools such as Microsoft Excel or Access. 

![EPA](images/Drinking_water.png)

**SDWIS - Safe Drinking Water Information System**

Information about safe drinking water is stored in SDWIS, the EPA's Safe Drinking Water Information System. SDWIS tracks information on drinking water contamination levels as required by the 1974 Safe Drinking Water Act and its 1986 and 1996 amendments. The Safe Drinking Water Act (SDWA) and accompanying regulations establish Maximum Contaminant Levels (MCLs), treatment techniques, and monitoring and reporting requirements to ensure that water provided to customers is safe for human consumption. The Safe Drinking Water Information System (SDWIS) contains information about public water systems and their violations of EPA's drinking water regulations. Searching SDWIS will allow you to locate your drinking water supplier and view its violations and enforcement history for the last ten years.

![](images/sdwis.PNG)

**UCMR - Unregulated Contaminant Monitoring Rule**

EPA collects data for chemicals and microbes that may be present in drinking water, but are not currently subject to EPA drinking water regulations.

The UCMR program was developed in coordination with the Contaminant Candidate List (CCL) a list of contaminants that:

Are not regulated by the National Primary Drinking Water Regulations
Are known or anticipated to occur at public water systems
May warrant regulation under the SDWA

What are the public health benefits of UCMR?
This permits assessment of the population being exposed and the levels of exposure.

UCMR data represent one of the primary sources of national occurrence data in drinking water that EPA uses to inform regulatory and other risk management decisions for drinking water contaminant candidates.

![](images/UCMR.PNG)


### Packages

```{r packages, message=FALSE, warning=FALSE}

library(plyr)
library(knitr)
library(readr)
library(tidyverse)
library(tidymodels)
library(DT)
library(dplyr)
library(textrecipes)
library(ggplot2)
library(lubridate)
set.seed(1234)

```

### Data
#### {.tabset}
##### API_data


**Dataset # 1 - Using API**

Safe Drinking Water Information System (SDWIS)

![](Images/Drinking_water.png)

```{r load data 1, warning=FALSE, eval=FALSE}
# EPA API
#change import way

#URL <- ("https://data.epa.gov/efservice/VIOLATION/CSV")

library(readr)

api_data <- read_csv("data/EnvirofactsRestAP_violations.csv")



```

##### EPA_data

**Dataset # 2 - Csv** 

National Contaminant Occurrence Database (NCOD)

EPA developed the National Contaminant Occurrence Database (NCOD) to satisfy statutory requirements in the 1996 Amendments to the Safe Drinking Water Act (SDWA). 

The 1996 Amendments require EPA to assemble and maintain a national drinking water contaminant occurrence database using information for both regulated and unregulated contaminants in public water systems.

![](Images/water-testing-1020x510.jpg)

```{r load data 2, eval=FALSE}
library(readr)

water_data <- read_delim("data/UCMR4_All_MA_WY.txt", 
    "\t", escape_double = FALSE, locale = locale(encoding = "Latin1"), 
    trim_ws = TRUE)
names(water_data)
```

##### Exploratory Analysis

**Dataset 1 - APi Data**

```{r api water, eval=FALSE}
library(dplyr)

api_water <- api_data %>% 
  select(Facility_name = VIOLATION.PWSID,
         Pop_served = VIOLATION.POPULATION_SERVED_COUNT,
         State = VIOLATION.PRIMACY_AGENCY_CODE,
         Health = VIOLATION.IS_HEALTH_BASED_IND,
         Contaminant = VIOLATION.CONTAMINANT_CODE,
         Result_value = VIOLATION.VIOL_MEASURE,
         State_MCL = VIOLATION.STATE_MCL)
```

```{r api clean, eval=FALSE}

library(tidyr)
api_clean <- api_water %>% 
  drop_na()

```

```{r write csv, echo=FALSE, message=FALSE, eval=FALSE}
library(readr)

write_csv(api_clean,"api_clean.csv", col_names = TRUE)
```

```{r, echo=FALSE, message=FALSE,warning=FALSE}

library(readr)

api_clean2 <- read_csv("api_clean2.csv")

```

```{r clean skim, warning=FALSE}
library(skimr)
library(ggplot2)

 api_clean2 %>% skim()
 
```



**Dataset 2 - Epa Water**

```{r epa water, eval=FALSE}
epa_water <- water_data %>% 
  select(PWSName,
         Size,
         FacilityName,
         FacilityWaterType,
         CollectionDate,
         Contaminant,
         MRL,
         Result = AnalyticalResultsSign,
         Result_value = `AnalyticalResultValue(Âµg/L)`,
         State)
  
```

```{r epa water tidy, eval= FALSE, message=FALSE, warning=FALSE}

library(plyr)
library(lubridate)

epa_water <- epa_water %>% 
  mutate(Result = replace(Result, Result == "=", TRUE),
         Date = mdy(CollectionDate),
         CollectionDate = NULL) %>% 
  mutate(MRL = as.numeric(MRL))

```

```{r epa clean, eval=FALSE}

library(tidyr)

epa_clean <- epa_water %>% 
  drop_na()
```

```{r epa write csv, echo=FALSE, message=FALSE, eval=FALSE}
library(readr)

write_csv(epa_clean,"epa_clean.csv", col_names = TRUE)

```
```{r}

epa_clean <- read_csv("epa_clean.csv")
```

```{r, echo=FALSE, eval=FALSE}

library(lubridate)

epa_clean <- epa_clean %>% 
  mutate(Date = ymd(Date))

```

```{r}

```

##### Relationships

Correlation is a measure of the relationship or interdependence of two variables. In other words, how much do the values of one variable change with the values of another. Correlation can be either positive or negative and it ranges from -1 to 1, with 1 and -1 indicating perfect correlation (1 being positive and -1 being negative) and 0 indicating no correlation.

**Dataset 1 - APi Data**

```{r analytics, warning=FALSE, message=FALSE}

library(PerformanceAnalytics)

api_clean2 %>% 
  select_if(is.numeric) %>% 
  chart.Correlation()

```

```{r ggally, warning=FALSE,message=FALSE}

library(GGally)

api_clean2 %>% 
  select_if(is.numeric) %>% 
  ggcorr(label = TRUE)

```

```{r}
library(GGally)

api_clean2 %>% 
  select_if(is.numeric) %>% 
  ggpairs()
```

**Dataset 2 - APi Data**

```{r analytics2, warning=FALSE, message=FALSE}

library(PerformanceAnalytics)

epa_clean %>% 
  select_if(is.numeric) %>% 
  chart.Correlation()

```

```{r ggally2, warning=FALSE,message=FALSE}

library(GGally)

epa_clean %>% 
  select_if(is.numeric) %>% 
  ggcorr(label = TRUE)

```

```{r}
library(GGally)

epa_clean %>% 
  select_if(is.numeric) %>% 
  ggpairs()
```

##### Contaminants

**Definition**

The Safe Drinking Water Act (SDWA) defines "contaminant" as any physical, chemical, biological or radiological substance or matter in water. Drinking water may reasonably be expected to contain at least small amounts of some contaminants. Some contaminants may be harmful if consumed at certain levels in drinking water. The presence of contaminants does not necessarily indicate that the water poses a health risk.

```{r contaminants}


```



```{r, message=FALSE, warning=FALSE}
ggplot(epa_clean) +
 aes(x = Date, fill = Contaminant) +
 geom_histogram(bins = 30L) +
 scale_fill_hue(direction = 1) +
 labs(subtitle = "Contaminants per State") +
 theme_minimal() +
 facet_wrap(vars(State))
```


[](images/Contaminants_states.png)


##### Research Question


```{r research}

# lets take a look at the data 



```

```{r research2}


```

#### {-}

### Inference


```{r inference}
library(dplyr)

```


#### Model


```{r levels, warning=FALSE, message=FALSE}

```

```{r train}

```

```{r test}

```

**Recipes Package**

Recipes allows to create a specification of preprocessing steps we want to perform.

```{r recipes}


```

**Text Recipes**



```{r tokenize,  warning=FALSE}

library(textrecipes)
```

```{r workflow}

```

```{r discrim, warning=FALSE, message=FALSE}

library(discrim)

```

#### Conclusion


```{r}

```

**resampling estimates of performance**

```{r resampling estimates}


```

```{r model fitting, eval=FALSE}

library(naivebayes)

```

```{r collect metrics, eval=FALSE}

```

```{r performance metrics, eval=FALSE}

```

```{r, eval=FALSE}

```

